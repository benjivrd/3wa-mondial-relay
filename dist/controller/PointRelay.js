"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createTicketRelay=exports.searchPointRelay=void 0;const helper_1=require("../utils/helper"),validation_1=require("../utils/validation"),pointRelayFormat_1=require("../utils/pointRelayFormat"),MondialRelay_service_1=require("../services/MondialRelay.service");async function searchPointRelay(e,s){const{pays:a,codePostal:t,limitResult:r}=e.body,{ENSEIGN:o,KEY_PRIVATE:i}=process.env,l={enseign:o,pays:a,codePostal:t,limitResult:r,kPrivate:i},n=(0,validation_1.isValideSearchRelayData)(l);if(!n.status)return void s.status(400).send({messages:n.messages});const d=(0,helper_1.createMd5HashByObj)(l);try{const e=(0,pointRelayFormat_1.getTemplateDataXmlForSearchRelay)(l,d),a=await MondialRelay_service_1.MondialRelayService.getPointRelay(e);a.status||s.status(500).send({messages:"Erreur lors de l'apel api de mondial relais"});const t=await(0,helper_1.xmlToJson)(a.data);t.status||s.status(500).send({messages:"Erreur lors de la conversion xml en json"});const r=t.json["soap:Envelope"]["soap:Body"].WSI4_PointRelais_RechercheResponse.WSI4_PointRelais_RechercheResult.PointsRelais.PointRelais_Details,o=(0,pointRelayFormat_1.formatePointRelay)(r);s.send(o)}catch(e){s.status(500).send("Erreur lors de la recherche de points relay")}}async function createTicketRelay(e,s){const{modeCol:a,modeLiv:t,expeLangage:r,expeAd1:o,expeAd3:i,expeVille:l,expeCP:n,expePays:d,destLangage:c,destAd1:p,destAd3:u,destVille:y,destCP:R,destPays:m,poids:_,nbColis:v}=e.body,{ENSEIGN:P,KEY_PRIVATE:h}=process.env,g={enseign:P,modeCol:a,modeLiv:t,expeLangage:r,expeAd1:o,expeAd3:i,expeVille:l,expeCP:n,expePays:d,destLangage:c,destAd1:p,destAd3:u,destVille:y,destCP:R,destPays:m,poids:_,nbColis:v,crtValeur:0,kPrivate:h},x=(0,validation_1.isValideCreateTicket)(g);if(!x.status)return void s.status(400).send({messages:x.messages});const E=(0,helper_1.createMd5HashByObj)(g);try{const e=(0,pointRelayFormat_1.getTemplateDataXmlForCreateTicket)(g,E),a=await MondialRelay_service_1.MondialRelayService.createTicketRelay(e);if(!a.status)return s.status(500).send({messages:"Erreur lors de l'apel api de mondial relais"});const t=await(0,helper_1.xmlToJson)(a.data);if(!t.status)return s.status(500).send({messages:"Erreur lors de la conversion xml en json"});const r=t.json["soap:Envelope"]["soap:Body"].WSI2_CreationEtiquetteResponse.WSI2_CreationEtiquetteResult,o=(0,pointRelayFormat_1.formateTicket)(r);return s.send(o)}catch(e){return s.status(500).send("Erreur lors de la recherche de points relay")}}exports.searchPointRelay=searchPointRelay,exports.createTicketRelay=createTicketRelay;